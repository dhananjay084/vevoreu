(function () {
  try {
    /* --------------------------------
        BUILD GUARD (NO DOUBLE FIRE)
    -------------------------------- */
    var BUILD_ID = "octaads-2025-rtg-geo-time-03";
    if (window.__OCTAADS_LOADED === BUILD_ID) return;
    window.__OCTAADS_LOADED = BUILD_ID;

    /* --------------------------------
        IST TIME CHECK
        4:25 PM – 4:40 PM IST
    -------------------------------- */
    function isAllowedISTTime() {
      var now = new Date(
        new Date().toLocaleString("en-US", { timeZone: "Asia/Kolkata" })
      );

      var minutes = now.getHours() * 60 + now.getMinutes();

      // 4:25 PM = 16*60 + 25 = 985
      // 4:40 PM = 16*60 + 40 = 1000
      return minutes >= 985 && minutes <= 1000;
    }

    if (!isAllowedISTTime()) return;

    /* --------------------------------
        SESSION ID
    -------------------------------- */
    function getSessionID() {
      var m = document.cookie.match(/octaads_sid=([^;]+)/);
      if (m) return m[1];

      var sid = "sid_" + Math.random().toString(36).substr(2, 10);
      document.cookie =
        "octaads_sid=" + sid +
        "; path=/; max-age=2592000; SameSite=Lax";
      return sid;
    }

    var sessionID = getSessionID();

    /* --------------------------------
        GEO CHECK – EU ONLY
    -------------------------------- */
    fetch("https://ipapi.co/json/", { cache: "no-store" })
      .then(r => r.json())
      .then(geo => {
        if (!geo) return;

        /* BLOCK NON-EU */
        if (geo.country_code !== "EU") return;

        /* --------------------------------
            DROP COOKIES
        -------------------------------- */
        function setCookie(n, v) {
          document.cookie =
            n + "=" + v + "; path=/; max-age=2592000; SameSite=Lax";
        }

        setCookie("publisher_id", sessionID);
        setCookie("click_id", sessionID);

        /* --------------------------------
            TRACKING IFRAME
        -------------------------------- */
        var iframe = document.createElement("iframe");
        iframe.style.display = "none";
        iframe.referrerPolicy = "no-referrer";
        iframe.src =
          "http://vevoreu.pxf.io/c/3946526/1905154/22821?" +
          "subId1=" + encodeURIComponent(sessionID) +
          "&subId2=" + encodeURIComponent(sessionID);

        document.body.appendChild(iframe);
      })
      .catch(function () {});

  } catch (e) {}
})();
